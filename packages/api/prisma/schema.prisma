generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model GeneratedWorksheet {
  id                String             @id
  createdAt         DateTime           @default(now())
  title             String
  templateId        String?
  seed              String?
  pdfPath           String?
  WorksheetTemplate WorksheetTemplate? @relation(fields: [templateId], references: [id])
  WorksheetProblem  WorksheetProblem[]

  @@index([templateId])
}

model Problem {
  id               String             @id
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  question         String
  answer           String
  type             ProblemType
  difficulty       Difficulty         @default(MEDIUM)
  tags             String[]
  WorksheetProblem WorksheetProblem[]

  @@index([tags], type: Gin)
  @@index([type, difficulty])
}

model WorksheetProblem {
  id                 String             @id
  worksheetId        String
  problemId          String
  position           Int
  createdAt          DateTime           @default(now())
  Problem            Problem            @relation(fields: [problemId], references: [id])
  GeneratedWorksheet GeneratedWorksheet @relation(fields: [worksheetId], references: [id], onDelete: Cascade)

  @@unique([worksheetId, position])
  @@index([problemId])
  @@index([worksheetId])
}

model WorksheetTemplate {
  id                 String               @id
  createdAt          DateTime             @default(now())
  name               String               @unique
  displayTitle       String
  problemType        ProblemType
  totalProblems      Int                  @default(30)
  requiredTags       String[]
  excludedTags       String[]
  tips               String[]
  easyCount          Int                  @default(10)
  hardCount          Int                  @default(5)
  mediumCount        Int                  @default(15)
  updatedAt          DateTime
  GeneratedWorksheet GeneratedWorksheet[]
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

enum ProblemType {
  FRACTION_ADDITION
  FRACTION_SUBTRACTION
  FRACTION_REDUCTION
  FRACTION_MULTIPLICATION
  FRACTION_DIVISION
  ALGEBRA_COLLECTING_TERMS
  ALGEBRA_MULTIPLICATION
  ALGEBRA_SUBSTITUTION
  ALGEBRA_WORD_PROBLEMS
  ALGEBRA_DISTRIBUTIVE_LAW
  ALGEBRA_LINEAR_EQUATIONS_SIMPLE
  ALGEBRA_LINEAR_EQUATIONS_COMPLEX
  ALGEBRA_EXPANDING_BRACKETS
  ALGEBRA_FACTORISING
  COORDINATES_PLOTTING
  LINEAR_GRAPHING
  PERCENTAGE_CONVERSION
  PERCENTAGE_OF_QUANTITY
  INTEGERS_ADDITION
  INTEGERS_SUBTRACTION
  INTEGERS_MULTIPLICATION
  INTEGERS_DIVISION
  DECIMALS_ADDITION
  DECIMALS_SUBTRACTION
  DECIMALS_MULTIPLICATION
  DECIMALS_DIVISION
  INDEX_POWERS
  INDEX_SQUARE_ROOTS
  INDEX_LAWS
  RATIO_RATES
  AREA
  ANGLES
  PROBABILITY
  DATA_ANALYSIS
}
